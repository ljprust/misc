PROGRAM ODESOLVE

REAL*8 :: H,X
REAL*8, ALLOCATABLE :: Y(:),YSAVE(:,:)
INTEGER :: M,N,STEP,I,J

! READ STEP SIZE

WRITE(*,*) 'ENTER H'
READ(*,*) H

! OPEN INPUT DATA FILE

OPEN(UNIT=1,FILE='odedata.txt')

! READ NUMBER OF STATE VARIABLES

READ(1,*) N

! ALLOCATE NUMBER OF STATE VARIABLES

ALLOCATE(Y(N))

! READ INITIAL CONDITIONS ON Y

DO I=1,N
	READ(1,*) Y(I)
END DO

! READ NUMBER OF STEPS

READ(1,*) M

! ALLOCATE NUMBER OF STEPS

ALLOCATE(YSAVE(M,N))

! SAVE INITIAL CONDITIONS

DO I=1,N
	YSAVE(I,1)=Y(I)
END DO

! SET INITIAL VALUE OF X

X=0.0D0

! CALCULATE STATE VARIABLES

DO STEP=2,M

	! CALL FOURTH-ORDER RANGE-KUTTA METHOD

	CALL RK4(Y,H,N,X)
	
	! SAVE STATE VARIABLES
	
	DO I=1,N
		YSAVE(STEP,I)=Y(I)
	END DO
	
END DO

! OPEN OUTPUT FILE

OPEN(UNIT=2,FILE='odeoutput.txt')

! WRITE VALUES OF STATE VARIABLES AT ALL VALUES OF X

DO I=1,N

	DO J=1,M
		WRITE(2,*) YSAVE(J,I)
	END DO
	
	WRITE(2,*) ''
	
END DO

END PROGRAM